\subsubsection{Forwarding service}

This component is responsible of delivering messages from and to other nodes of
the system as a whole.

We show in figure \ref{fig:mw-forwarding} the architecture of this service and
then we will show in detail each module that composes this component.

\begin{figure}[H]
  \centering
  \includegraphics[width=\columnwidth]{images/solution/mw/forwarding.eps}
  \caption{Middleware's Forwarding service}
  \label{fig:mw-forwarding}
\end{figure}
% TODO: Can MessageQueue pass a message directly to Dispatcher if the message
%       is "local"?

\subsubsubsection{forwarding.Forwarding}

\begin{figure}[H]
  \centering
  \includegraphics[width=.5\columnwidth]{images/solution/mw/fwd/fwd.eps}
  \caption{forwarding.Forwarding}
  \label{fig:mw-forwarding-forwarding}
\end{figure}
    % TODO: check this out: will Message actually be a String?

\FloatBarrier
\begin{itemize}
  \item \textbf{Description} \\
    This module is the Fa\c cade of the Forwarding service. It is responsible
    to boot neatly and supervise all processes in Forwarding. Also, it has to
    handle message delivery requests that come from other components of the
    middleware.
  \item \textbf{Attributes}
  \item \textbf{Operations}
  \begin{itemize}
    \item \texttt{+ start()} \\
    Starts the Forwarding service.
    \item \texttt{+ handleMessage(message: String)} \\
    % TODO: check this out: will Message actually be a String?
    Handles the delivery of a given message to (possibly) other nodes.
  \end{itemize}
\end{itemize}

\subsubsubsection{forwarding.MessageQueue}

\begin{figure}[H]
  \centering
  \includegraphics[width=.5\columnwidth]{images/solution/mw/fwd/mq.eps}
  \caption{forwarding.MessageQueue}
  \label{fig:mw-forwarding-messagequeue}
\end{figure}
    % TODO: check this out: will Message actually be a String?

\FloatBarrier
\begin{itemize}
  \item \textbf{Description} \\
    Process that has to pass messages to a forwarding.MQProxy.
  \item \textbf{Attributes}
    \begin{itemize}
      \item \texttt{- queue: AbstractQueue<Message>} \\
    Queue of messages.
    \end{itemize}
  \item \textbf{Operations}
  \begin{itemize}
    \item \texttt{+ startLink(port: Int)} \\
    Starts the process and resume an eventual queue of messages from the
    last execution.
    \item \texttt{+ forward(message: String)} \\
    % TODO: check this out: will Message actually be a String?
    Enqueue a message.
    \item \texttt{+ getHead()} \\
    Returns the first enqueued message, if present.
    \item \texttt{+ removeHead()} \\
    Removes the first enqueued message, if present.
    \item \texttt{+ pause(pausingMsg: String)} \\
    % TODO: check this out: will Message actually be a String?
    Pauses the processing of enqueued messages. It also forwards this
    information to known nodes.
    \item \texttt{+ resume(resumptionMsg: String)} \\
    % TODO: check this out: will Message actually be a String?
    Resumes the processing of enqueued messages. It also forwards this
    information to known nodes.
  \end{itemize}
\end{itemize}

\subsubsubsection{forwarding.MQConsumer}

\begin{figure}[H]
  \centering
  \includegraphics[width=.4\columnwidth]{images/solution/mw/fwd/mqc.eps}
  \caption{forwarding.MQConsumer}
  \label{fig:mw-forwarding-mqconsumer}
\end{figure}

\FloatBarrier
\begin{itemize}
  \item \textbf{Description} \\
    Daemon worker that sequentially takes message from the MessageQueue to
    process them.
  \item \textbf{Attributes}
    \begin{itemize}
      \item \texttt{- paused: Boolean} \\
        Value that is false iff the queue has to stop processing items due to
        some middleware operation (e.g. snapshot).
    \end{itemize}
  \item \textbf{Operations}
  \begin{itemize}
    \item \texttt{+ waitToConsume()} \\
    Waits for new messages to be available in the MessageQueue.
  \end{itemize}
\end{itemize}

\subsubsubsection{forwarding.Dispatcher}

\begin{figure}[H]
  \centering
  \includegraphics[width=.4\columnwidth]{images/solution/mw/fwd/disp.eps}
  \caption{forwarding.Dispatcher}
  \label{fig:mw-forwarding-dispatcher}
\end{figure}
    % TODO: check this out: will Message actually be a String?

\FloatBarrier
\begin{itemize}
  \item \textbf{Description} \\
    Dispatches incoming messages from the message broker.
  \item \textbf{Attributes}
  \item \textbf{Operations}
  \begin{itemize}
    \item \texttt{+ dispatch(message: String)} \\
    Dispatches the message to the intended middleware service.
    % TODO: check this out: will Message actually be a String?
  \end{itemize}
\end{itemize}

\subsubsubsection{forwarding.proxy.MQProxy}

\begin{figure}[H]
  \centering
  \includegraphics[width=.45\columnwidth]{images/solution/mw/fwd/mqp.eps}
  \caption{forwarding.MQProxy}
  \label{fig:mw-forwarding-mqproxy}
\end{figure}
    % TODO: check this out: will Message actually be a String?

\FloatBarrier
\begin{itemize}
  \item \textbf{Description} \\
    Interface for processes that act in between middleware and a message
    broker.
  \item \textbf{Attributes}
  \item \textbf{Operations}
  \begin{itemize}
    \item \texttt{+ deliver(message: String)} \\
    % TODO: check this out: will Message actually be a String?
    Makes the Message Broker deliver the message to the intended recipients.
  \end{itemize}
\end{itemize}

\subsubsubsection{forwarding.proxy.RabbitMQProxy}

\begin{figure}[H]
  \centering
  \includegraphics[width=.45\columnwidth]{images/solution/mw/fwd/rmqp.eps}
  \caption{forwarding.MQProxy}
  \label{fig:mw-forwarding-mqproxy}
\end{figure}
    % TODO: check this out: will Message actually be a String?

\FloatBarrier
\begin{itemize}
  \item \textbf{Description} \\
    Module that implements the \texttt{forwarding.proxy.MQProxy}
    interface to exchange messages with RabbitMQ.
  \item \textbf{Attributes}
  \item \textbf{Operations}
  \begin{itemize}
    \item \texttt{+ deliver(message: String)} \\
    % TODO: check this out: will Message actually be a String?
    Delivers a message through the RabbitMQ message broker.
  \end{itemize}
\end{itemize}
